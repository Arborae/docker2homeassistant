from flask import session

SUPPORTED_LANGS = ["it", "en"]
DEFAULT_LANG = "it"

TRANSLATIONS = {
    "it": {
        "nav.containers": "Container",
        "nav.images": "Immagini",
        "nav.volumes": "Volumi",
        "nav.updates": "Aggiornamenti",
        "nav.autodiscovery": "MQTT",
        "nav.settings": "Impostazioni",
        "nav.security": "Sicurezza",
        "nav.logout": "Esci",
        "nav.events": "Eventi",
        "nav.home": "Dashboard",
        "login.title": "D2HA – Accesso",
        "login.button": "Accedi",
        "login.heading": "Benvenuto in D2HA",
        "login.username": "Nome utente",
        "login.password": "Password",
        "login.token": "Codice 2FA",
        "login.reminder": "Completa la configurazione iniziale se richiesto.",
        "password.strength.label": "Forza password",
        "password.strength.weak": "Debole",
        "password.strength.medium": "Media",
        "password.strength.strong": "Forte",
        "password.match": "Le password coincidono.",
        "password.mismatch": "Le password non coincidono.",
        "password.toggle.show": "Mostra password",
        "password.toggle.hide": "Nascondi password",
        "wizard.step1.title": "Configurazione account amministratore",
        "wizard.step2.title": "Autenticazione a due fattori (2FA)",
        "wizard.step3.title": "Modalità del sistema",
        "wizard.step4.title": "Autodiscovery MQTT e Home Assistant",
        "setup_account.title": "Aggiorna le credenziali di accesso",
        "setup_account.submit": "Continua",
        "setup_account.heading": "Proteggi il tuo accesso",
        "setup_account.intro": "Stai accedendo con le credenziali predefinite <strong>admin / admin</strong>. Per sicurezza devi scegliere una nuova password (e, se vuoi, anche un nuovo username). La vecchia password smetterà di funzionare.",
        "setup_account.tips_title": "Consigli rapidi:",
        "setup_account.tip_length": "Usa almeno 10 caratteri con lettere, numeri e simboli.",
        "setup_account.tip_unique": "Evita parole comuni o password già usate altrove.",
        "setup_account.tip_username": "L'username può restare \"{current_username}\" oppure puoi personalizzarlo.",
        "setup_account.new_username": "Nuovo username (facoltativo)",
        "setup_account.new_password": "Nuova password",
        "setup_account.confirm_password": "Conferma password",
        "setup_2fa.enable": "Abilita 2FA",
        "setup_2fa.skip": "Salta per ora",
        "setup_2fa.title": "Autenticazione a due fattori",
        "setup_2fa.intro": "Aggiungi un secondo fattore di sicurezza: ad ogni login, oltre a username e password, ti verrà chiesto un codice temporaneo generato sul tuo smartphone.",
        "setup_2fa.hint": "Consigliato se l'interfaccia è accessibile da internet o da utenti non fidati.",
        "setup_2fa.step1": "1. Apri Google Authenticator, Aegis o app simile.",
        "setup_2fa.step2": "2. Scansiona il QR code oppure inserisci manualmente il codice segreto.",
        "setup_2fa.step3": "3. Inserisci un codice a 6 cifre per confermare.",
        "setup_2fa.qr_title": "QR CODE",
        "setup_2fa.secret": "Codice segreto",
        "setup_2fa.uri": "URI: {uri}",
        "setup_2fa.token_label": "Codice 2FA",
        "setup_modes.title": "Modalità del sistema",
        "setup_modes.safe": "Modalità sicura",
        "setup_modes.performance": "Modalità prestazioni",
        "setup_modes.debug": "Modalità debug",
        "setup_modes.safe_note": "consigliata, attiva di default",
        "setup_modes.heading": "Modalità del sistema",
        "setup_modes.description": "Queste opzioni ti aiutano a bilanciare sicurezza e prestazioni. Puoi sempre modificarle in seguito dal pulsante con l'icona dell'ingranaggio in alto a destra.",
        "setup_modes.safe_hint": "Quando attiva, alcune modifiche critiche richiederanno conferma o verranno bloccate.",
        "setup_modes.performance_hint": "Riduce il carico sul server e il polling automatico. Utile su hardware poco potente o connessioni lente.",
        "setup_modes.debug_hint": "Abilita log dettagliati e strumenti di diagnostica. Usala solo quando necessario.",
        "setup_modes.submit": "Continua",
        "setup_autodiscovery.title": "Autodiscovery MQTT e Home Assistant",
        "setup_autodiscovery.enable_all": "Abilita tutte le entità",
        "setup_autodiscovery.disable_all": "Disattiva autodiscovery",
        "setup_autodiscovery.heading": "Autodiscovery MQTT e Home Assistant",
        "setup_autodiscovery.intro": "Docker2HomeAssistant può esporre automaticamente entità MQTT verso Home Assistant tramite autodiscovery.",
        "setup_autodiscovery.hint": "Dalla pagina autodiscovery potrai sempre selezionare con precisione quali entità pubblicare. Qui puoi scegliere il comportamento iniziale per le entità di default.",
        "setup_autodiscovery.enable_all_long": "Abilita tutte le entità MQTT di default",
        "setup_autodiscovery.enable_all_hint": "Consigliato se vuoi vedere subito tutti i dati in Home Assistant. Potrai disattivare le entità che non ti servono dalla pagina autodiscovery.",
        "setup_autodiscovery.disable_all_long": "Non abilitare nessuna entità per ora",
        "setup_autodiscovery.disable_all_hint": "Consigliato se preferisci mantenere Home Assistant pulito e abilitare manualmente solo le entità che ti interessano, dalla pagina autodiscovery.",
        "setup_autodiscovery.submit": "Completa configurazione",
        "safe_mode.label": "Modalità sicura",
        "performance_mode.label": "Modalità prestazioni",
        "debug_mode.label": "Modalità debug",
        "debug_mode.switch_title": "Attiva log diagnostici aggiuntivi",
        "theme.label": "Tema",
        "theme.dark": "Scuro",
        "theme.light": "Chiaro",
        "language.label": "Lingua",
        "language.italian": "Italiano",
        "language.english": "English",
        "settings.title": "Impostazioni",
        "settings.security_hint": "Gestisci autenticazione e modalità sicura.",
        "security.session_timeout_label": "Logout automatico per inattività (minuti)",
        "security.session_timeout_hint": "Dopo questo tempo senza richieste la sessione si chiude e serve un nuovo login.",
        "settings.performance_hint": "Riduci carico e polling automatico.",
        "settings.debug_hint": "Aumenta la verbosità dei log e delle diagnostiche.",
        "settings.safe_hint": "Richiedi conferma o blocca le modifiche critiche.",
        "settings.backend_status": "Stato backend",
        "settings.notifications": "Notifiche",
        "settings.close": "Chiudi",
        "settings.refresh": "Aggiorna ora",
        "settings.os": "OS installato",
        "settings.docker": "Versione Docker",
        "settings.d2ha_version": "Versione D2HA",
        "settings.uptime": "Uptime",
        "theme.switch_label": "Tema",
        "theme.dark.label": "Scuro",
        "theme.light.label": "Chiaro",
        "footer.logout": "Esci",
        "backend_status.no_recent_update": "Nessun aggiornamento riuscito di recente",
        "backend_status.last_update": "Ultimo aggiornamento dati: {timestamp}",
        "home.aside_title": "Stack e container",
        "home.server_status": "Stato del server",
        "home.total_label": "totale",
        "home.cpu_caption": "Carico medio degli ultimi campioni",
        "home.ram_caption": "Andamento utilizzo memoria",
        "home.paused": "in pausa",
        "home.stopped": "fermi",
        "home.legend.running": "Running",
        "home.legend.paused": "In pausa",
        "home.legend.stopped": "Fermi",
        "home.legend.in_use": "In uso",
        "home.legend.not_in_use": "Non in uso",
        "home.stacks_title": "Stack",
        "home.no_stack": "Senza stack",
        "home.stack_container_label": "container",
        "home.network": "Rete",
        "home.log.title": "Log container",
        "home.log.close": "Chiudi log",
        "home.log.auto": "Auto-refresh",
        "home.log.lines": "Linee",
        "home.log.unlimited": "Senza limiti",
        "home.log.severity": "Severità",
        "home.log.all": "Tutte",
        "home.log.errors": "Errori",
        "home.log.warnings": "Warning",
        "home.log.info": "Info",
        "home.log.debug": "Debug",
        "home.log.other": "Altro",
        "home.log.refresh": "Aggiorna ora",
        "home.log.placeholder": "Seleziona un container...",
        "home.log.no_logs": "Nessun log per la severità selezionata",
        "home.log.open": "Apri log di {name}",
        "flash.login_rate_limited": "Troppi tentativi di accesso falliti da questo indirizzo. Riprova più tardi.",
        "flash.invalid_credentials": "Credenziali o codice 2FA non validi.",
        "flash.password_required": "Scegli una password.",
        "flash.passwords_mismatch": "Le password non coincidono.",
        "flash.password_admin_forbidden": "Per sicurezza, la password non può rimanere 'admin'.",
        "flash.password_length_short": "Scegli una password più lunga (almeno 10 caratteri).",
        "flash.account_updated_onboarding": "Account aggiornato. Completiamo la configurazione della sicurezza.",
        "flash.setup2fa_skipped": "L'autenticazione a due fattori è disattivata. Potrai abilitarla più tardi nelle Impostazioni di sicurezza.",
        "flash.setup2fa_enabled": "Autenticazione a due fattori abilitata.",
        "flash.setup2fa_invalid_code": "Codice di verifica non valido. Riprova.",
        "flash.autodiscovery_invalid_choice": "Seleziona una opzione valida per l'autodiscovery MQTT.",
        "flash.autodiscovery_apply_failed": "Impossibile applicare automaticamente l'autodiscovery MQTT. Puoi riprovare dalla pagina Autodiscovery.",
        "flash.autodiscovery_complete": "Configurazione iniziale completata. Potrai modificare queste impostazioni in qualsiasi momento.",
        "flash.autodiscovery_partial": "Configurazione iniziale completata, ma alcune impostazioni MQTT potrebbero richiedere un nuovo tentativo dalla pagina Autodiscovery.",
        "flash.security_current_password_incorrect": "Password attuale non corretta.",
        "flash.security_current_totp_missing": "Inserisci il codice 2FA corrente.",
        "flash.security_totp_config_invalid": "Configurazione 2FA non valida. Riavvia la procedura.",
        "flash.security_totp_invalid": "Codice 2FA non valido. Riprova.",
        "flash.security_new_passwords_mismatch": "Le nuove password non coincidono.",
        "flash.security_new_password_admin_forbidden": "Per sicurezza, la password non può essere 'admin'.",
        "flash.security_new_password_short": "Scegli una password più lunga (almeno 10 caratteri).",
        "flash.security_password_updated": "Password aggiornata correttamente.",
        "flash.security_no_changes": "Nessuna modifica effettuata.",
        "flash.security_fix_errors": "Correggi gli errori e riprova.",
        "flash.security_credentials_updated": "Credenziali aggiornate.",
        "flash.security_session_timeout_updated": "Timeout di sessione aggiornato.",
        "flash.security_timeout_invalid": "Il timeout deve essere tra 1 e 1440 minuti.",
        "flash.security_2fa_already_enabled": "2FA già abilitata.",
        "flash.security_scan_qr_to_enable": "Scansiona il codice e conferma con un token per abilitare la 2FA.",
        "flash.security_totp_secret_missing": "Segreto TOTP non disponibile. Riavvia la procedura.",
        "flash.security_2fa_enabled_invalid_code": "Codice 2FA non valido. Riprova.",
        "flash.security_2fa_enabled": "Autenticazione a due fattori abilitata con successo.",
        "flash.security_2fa_already_disabled": "2FA già disabilitata.",
        "flash.security_2fa_disabled_warning": "2FA disabilitata. Attenzione: l’account è ora protetto solo da username e password.",
        "flash.session_expired": "Sessione terminata per inattività. Effettua di nuovo l'accesso.",
        "login.onboarding_hint": "Accedi con le credenziali amministrative. Al primo login con <strong>admin / admin</strong> ti guideremo in un rapido setup sicuro.",
    },
    "en": {
        "nav.containers": "Containers",
        "nav.images": "Images",
        "nav.volumes": "Volumes",
        "nav.updates": "Updates",
        "nav.autodiscovery": "MQTT",
        "nav.settings": "Settings",
        "nav.security": "Security",
        "nav.logout": "Logout",
        "nav.events": "Events",
        "nav.home": "Dashboard",
        "login.title": "D2HA – Login",
        "login.button": "Sign in",
        "login.heading": "Welcome to D2HA",
        "login.username": "Username",
        "login.password": "Password",
        "login.token": "2FA code",
        "login.reminder": "Complete the initial setup if prompted.",
        "password.strength.label": "Password strength",
        "password.strength.weak": "Weak",
        "password.strength.medium": "Medium",
        "password.strength.strong": "Strong",
        "password.match": "Passwords match.",
        "password.mismatch": "Passwords do not match.",
        "password.toggle.show": "Show password",
        "password.toggle.hide": "Hide password",
        "wizard.step1.title": "Admin account setup",
        "wizard.step2.title": "Two-factor authentication (2FA)",
        "wizard.step3.title": "System modes",
        "wizard.step4.title": "MQTT Autodiscovery & Home Assistant",
        "setup_account.title": "Update sign-in credentials",
        "setup_account.submit": "Continue",
        "setup_account.heading": "Protect your access",
        "setup_account.intro": "You are signing in with the default credentials <strong>admin / admin</strong>. For security you must choose a new password (and, if you want, a new username). The old password will stop working.",
        "setup_account.tips_title": "Quick tips:",
        "setup_account.tip_length": "Use at least 10 characters with letters, numbers, and symbols.",
        "setup_account.tip_unique": "Avoid common words or passwords already used elsewhere.",
        "setup_account.tip_username": "The username can stay \"{current_username}\" or you can customize it.",
        "setup_account.new_username": "New username (optional)",
        "setup_account.new_password": "New password",
        "setup_account.confirm_password": "Confirm password",
        "setup_2fa.enable": "Enable 2FA",
        "setup_2fa.skip": "Skip for now",
        "setup_2fa.title": "Two-factor authentication",
        "setup_2fa.intro": "Add a second security factor: at each login, besides username and password, you'll be asked for a temporary code generated on your phone.",
        "setup_2fa.hint": "Recommended if the interface is reachable from the internet or untrusted users.",
        "setup_2fa.step1": "1. Open Google Authenticator, Aegis, or a similar app.",
        "setup_2fa.step2": "2. Scan the QR code or enter the secret code manually.",
        "setup_2fa.step3": "3. Enter a 6-digit code to confirm.",
        "setup_2fa.qr_title": "QR CODE",
        "setup_2fa.secret": "Secret code",
        "setup_2fa.uri": "URI: {uri}",
        "setup_2fa.token_label": "2FA code",
        "setup_modes.title": "System modes",
        "setup_modes.safe": "Safe mode",
        "setup_modes.performance": "Performance mode",
        "setup_modes.debug": "Debug mode",
        "setup_modes.heading": "System modes",
        "setup_modes.description": "These options help you balance security and performance. You can always change them later from the gear icon at the top right.",
        "setup_modes.safe_hint": "When enabled, some critical changes will require confirmation or be blocked.",
        "setup_modes.performance_hint": "Lowers server load and automatic polling. Useful on low-power hardware or slow connections.",
        "setup_modes.debug_hint": "Enables verbose logs and diagnostics. Recommended only when needed.",
        "setup_modes.submit": "Continue",
        "setup_modes.safe_note": "recommended, enabled by default",
        "setup_autodiscovery.title": "MQTT Autodiscovery & Home Assistant",
        "setup_autodiscovery.enable_all": "Enable all entities",
        "setup_autodiscovery.disable_all": "Disable autodiscovery",
        "setup_autodiscovery.heading": "MQTT Autodiscovery & Home Assistant",
        "setup_autodiscovery.intro": "Docker2HomeAssistant can automatically expose MQTT entities to Home Assistant via autodiscovery.",
        "setup_autodiscovery.hint": "From the autodiscovery page you can always choose exactly which entities to publish. Here you can set the initial behaviour for default entities.",
        "setup_autodiscovery.enable_all_long": "Enable all default MQTT entities",
        "setup_autodiscovery.enable_all_hint": "Recommended if you want to see all data in Home Assistant right away. You can disable unneeded entities from the autodiscovery page.",
        "setup_autodiscovery.disable_all_long": "Don't enable any entities for now",
        "setup_autodiscovery.disable_all_hint": "Recommended if you prefer to keep Home Assistant clean and manually enable only the entities you need from the autodiscovery page.",
        "setup_autodiscovery.submit": "Finish setup",
        "safe_mode.label": "Safe mode",
        "performance_mode.label": "Performance mode",
        "debug_mode.label": "Debug mode",
        "debug_mode.switch_title": "Enable extra diagnostic logging",
        "theme.label": "Theme",
        "theme.dark": "Dark",
        "theme.light": "Light",
        "language.label": "Language",
        "language.italian": "Italiano",
        "language.english": "English",
        "settings.title": "Settings",
        "settings.security_hint": "Manage authentication and safe mode.",
        "security.session_timeout_label": "Automatic logout after inactivity (minutes)",
        "security.session_timeout_hint": "After this time without requests the session ends and login is required again.",
        "settings.performance_hint": "Reduce load and automatic polling.",
        "settings.debug_hint": "Increase logging verbosity and diagnostics.",
        "settings.safe_hint": "Require confirmation or block critical changes.",
        "settings.backend_status": "Backend status",
        "settings.notifications": "Notifications",
        "settings.close": "Close",
        "settings.refresh": "Refresh now",
        "settings.os": "Installed OS",
        "settings.docker": "Docker version",
        "settings.d2ha_version": "D2HA version",
        "settings.uptime": "Uptime",
        "theme.switch_label": "Theme",
        "theme.dark.label": "Dark",
        "theme.light.label": "Light",
        "footer.logout": "Logout",
        "backend_status.no_recent_update": "No recent successful updates",
        "backend_status.last_update": "Last data update: {timestamp}",
        "home.aside_title": "Stacks and containers",
        "home.server_status": "Server status",
        "home.total_label": "total",
        "home.cpu_caption": "Average load over latest samples",
        "home.ram_caption": "Memory usage trend",
        "home.paused": "paused",
        "home.stopped": "stopped",
        "home.legend.running": "Running",
        "home.legend.paused": "Paused",
        "home.legend.stopped": "Stopped",
        "home.legend.in_use": "In use",
        "home.legend.not_in_use": "Not in use",
        "home.stacks_title": "Stacks",
        "home.no_stack": "No stack",
        "home.stack_container_label": "container",
        "home.network": "Network",
        "home.log.title": "Container logs",
        "home.log.close": "Close logs",
        "home.log.auto": "Auto-refresh",
        "home.log.lines": "Lines",
        "home.log.unlimited": "Unlimited",
        "home.log.severity": "Severity",
        "home.log.all": "All",
        "home.log.errors": "Errors",
        "home.log.warnings": "Warnings",
        "home.log.info": "Info",
        "home.log.debug": "Debug",
        "home.log.other": "Other",
        "home.log.refresh": "Refresh now",
        "home.log.placeholder": "Select a container...",
        "home.log.no_logs": "No logs for the selected severity",
        "home.log.open": "Open logs for {name}",
        "flash.login_rate_limited": "Too many failed login attempts from this address. Please try again later.",
        "flash.invalid_credentials": "Invalid credentials or 2FA code.",
        "flash.password_required": "Please choose a password.",
        "flash.passwords_mismatch": "Passwords do not match.",
        "flash.password_admin_forbidden": "For security, the password cannot remain 'admin'.",
        "flash.password_length_short": "Choose a longer password (at least 10 characters).",
        "flash.account_updated_onboarding": "Account updated. Let's finish configuring security.",
        "flash.setup2fa_skipped": "Two-factor authentication is disabled. You can enable it later in Security settings.",
        "flash.setup2fa_enabled": "Two-factor authentication enabled.",
        "flash.setup2fa_invalid_code": "Invalid verification code. Please try again.",
        "flash.autodiscovery_invalid_choice": "Select a valid option for MQTT autodiscovery.",
        "flash.autodiscovery_apply_failed": "Could not automatically apply MQTT autodiscovery. You can retry from the Autodiscovery page.",
        "flash.autodiscovery_complete": "Initial setup completed. You can change these settings anytime.",
        "flash.autodiscovery_partial": "Initial setup completed, but some MQTT settings may need another try from the Autodiscovery page.",
        "flash.security_current_password_incorrect": "Current password is incorrect.",
        "flash.security_current_totp_missing": "Enter the current 2FA code.",
        "flash.security_totp_config_invalid": "Invalid 2FA configuration. Restart the process.",
        "flash.security_totp_invalid": "Invalid 2FA code. Please try again.",
        "flash.security_new_passwords_mismatch": "New passwords do not match.",
        "flash.security_new_password_admin_forbidden": "For security, the password cannot be 'admin'.",
        "flash.security_new_password_short": "Choose a longer password (at least 10 characters).",
        "flash.security_password_updated": "Password updated successfully.",
        "flash.security_no_changes": "No changes made.",
        "flash.security_fix_errors": "Fix the errors and try again.",
        "flash.security_credentials_updated": "Credentials updated.",
        "flash.security_session_timeout_updated": "Session timeout updated.",
        "flash.security_timeout_invalid": "Timeout must be between 1 and 1440 minutes.",
        "flash.security_2fa_already_enabled": "2FA already enabled.",
        "flash.security_scan_qr_to_enable": "Scan the code and confirm with a token to enable 2FA.",
        "flash.security_totp_secret_missing": "TOTP secret not available. Restart the process.",
        "flash.security_2fa_enabled_invalid_code": "Invalid 2FA code. Please try again.",
        "flash.security_2fa_enabled": "Two-factor authentication enabled successfully.",
        "flash.security_2fa_already_disabled": "2FA already disabled.",
        "flash.security_2fa_disabled_warning": "2FA disabled. Warning: the account is now protected only by username and password.",
        "flash.session_expired": "Session ended due to inactivity. Please sign in again.",
        "login.onboarding_hint": "Sign in with the admin credentials. On first login with <strong>admin / admin</strong> we'll guide you through a quick secure setup.",
    },
}


def get_current_lang() -> str:
    lang = session.get("lang") or DEFAULT_LANG
    if lang not in SUPPORTED_LANGS:
        lang = DEFAULT_LANG
    return lang


def set_current_lang(lang: str) -> None:
    if lang in SUPPORTED_LANGS:
        session["lang"] = lang


def t(key: str) -> str:
    lang = get_current_lang()
    return TRANSLATIONS.get(lang, {}).get(
        key,
        TRANSLATIONS.get(DEFAULT_LANG, {}).get(key, key),
    )
