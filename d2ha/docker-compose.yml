version: "3.8"

services:
  d2ha_server:
    build:
      context: .
      args:
        D2HA_VERSION: ${D2HA_VERSION:-dev}
    container_name: d2ha_server
    ports:
      - "12021:12021"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./data:/app/data
    environment:
      D2HA_AUTH_CONFIG_PATH: ${D2HA_AUTH_CONFIG_PATH:-/app/data/auth_config.json}
      MQTT_BROKER: ${MQTT_BROKER}
      MQTT_PORT: ${MQTT_PORT:-1883}
      MQTT_USERNAME: ${MQTT_USERNAME}
      MQTT_PASSWORD: ${MQTT_PASSWORD}
      MQTT_BASE_TOPIC: ${MQTT_BASE_TOPIC:-d2ha_server}
      MQTT_DISCOVERY_PREFIX: ${MQTT_DISCOVERY_PREFIX:-homeassistant}
      MQTT_NODE_ID: ${MQTT_NODE_ID:-d2ha_server}
    restart: unless-stopped
