<!DOCTYPE html>
<html lang="{{ get_current_lang() }}">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>D2HA – Volumi</title>
  {% include 'partials/notifications_styles.html' %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
</head>

<body class="theme-{{ get_current_theme() }}" data-safe-mode="{{ '1' if safe_mode_enabled else '0' }}"
  data-performance-mode="{{ '1' if performance_mode_enabled else '0' }}"
  data-debug-mode="{{ '1' if debug_mode_enabled else '0' }}">
  <header>
    <div class="header-shell">
      {% include 'partials/notifications_panel.html' %}
      <nav id="primaryNav" role="navigation">
        <a href="{{ url_for('ui.index') }}" class="tab {{ 'active' if active_page == 'home' else '' }}">Home</a>
        <a href="{{ url_for('ui.containers_view') }}"
          class="tab {{ 'active' if active_page == 'containers' else '' }}">{{
          t("nav.containers") }}</a>
        <a href="{{ url_for('ui.images_view') }}" class="tab {{ 'active' if active_page == 'images' else '' }}">{{
          t("nav.images") }}</a>
        <a href="{{ url_for('ui.volumes_view') }}" class="tab {{ 'active' if active_page == 'volumes' else '' }}">{{
          t("nav.volumes") }}</a>
        <a href="{{ url_for('ui.networks_view') }}" class="tab {{ 'active' if active_page == 'networks' else '' }}">{{
          t("nav.networks") }}</a>
        <a href="{{ url_for('ui.updates') }}" class="tab {{ 'active' if active_page == 'updates' else '' }}">{{
          t("nav.updates") }}</a>
        <a href="{{ url_for('ui.events_view') }}" class="tab {{ 'active' if active_page == 'events' else '' }}">{{
          t("nav.events") }}</a>
        <a href="{{ url_for('ui.autodiscovery_view') }}"
          class="tab {{ 'active' if active_page == 'autodiscovery' else '' }}">{{ t("nav.autodiscovery") }}</a>
        <a href="{{ url_for('auth.logout') }}" class="tab logout-link">{{ t("nav.logout") }}</a>
      </nav>
    </div>
  </header>

  {% include 'partials/flash_messages.html' %}

  <main>
    <div class="card">
      <div class="card-header">
        <div class="meta">Totale volumi: {{ volumes|length }} · Container attivi: {{ summary.running }}</div>
        <div class="actions-row">
          <form id="delete-unused-volumes" method="post" action="{{ url_for('ui.delete_unused_volumes') }}"
            data-safe-confirm="Eliminare tutti i volumi non utilizzati?" data-safe-modal="external">
            <button class="btn btn-accent" type="submit">Elimina volumi non utilizzati</button>
          </form>
        </div>
      </div>
    </div>

    <section class="card">
      <table class="responsive-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Tipo</th>
            <th>Percorso</th>
            <th>Creato</th>
            <th>Utilizzo</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody>
          {% for volume in volumes %}
          {% set is_used = volume.used_by|length > 0 %}
          <tr>
            <td data-label="Nome"><strong>{{ volume.name }}</strong></td>
            <td data-label="Tipo"><span class="pill pill-type">{{ 'Fisico' if volume.type == 'bind' else 'Virtuale'
                }}</span></td>
            <td data-label="Percorso">
              <div>{{ volume.mountpoint }}</div>
              <div class="meta">Driver: {{ volume.driver }}</div>
            </td>
            <td data-label="Creato">{{ volume.created }}</td>
            <td data-label="Utilizzo">
              {% if is_used %}
              <span class="pill pill-used">In uso</span>
              <div class="meta">{{ volume.used_by|join(', ') }}</div>
              {% else %}
              <span class="pill pill-unused">Non utilizzato</span>
              {% endif %}
            </td>
            <td data-label="Azioni">
              <form method="post" action="{{ url_for('ui.delete_volume') }}"
                data-safe-confirm="Eliminare il volume {{ volume.name }}?" data-safe-modal="external">
                <input type="hidden" name="volume_name" value="{{ volume.name }}" />
                <input type="hidden" name="volume_type" value="{{ volume.type }}" />
                <button class="btn btn-danger" type="submit" {% if is_used %}disabled{% endif %}>Elimina</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
  </main>

  {% include 'partials/notifications_script.html' %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>

</html>