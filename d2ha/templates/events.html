<!DOCTYPE html>
<html lang="{{ get_current_lang() }}">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>D2HA – Eventi</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
  {% include 'partials/notifications_styles.html' %}
</head>

<body class="theme-{{ get_current_theme() }}" data-safe-mode="{{ '1' if safe_mode_enabled else '0' }}"
  data-performance-mode="{{ '1' if performance_mode_enabled else '0' }}"
  data-debug-mode="{{ '1' if debug_mode_enabled else '0' }}">
  <header>
    <div class="header-shell">
      {% include 'partials/notifications_panel.html' %}
      <nav id="primaryNav" role="navigation">
        <a href="{{ url_for('ui.index') }}" class="tab {{ 'active' if active_page == 'home' else '' }}">Home</a>
        <a href="{{ url_for('ui.containers_view') }}"
          class="tab {{ 'active' if active_page == 'containers' else '' }}">{{
          t("nav.containers") }}</a>
        <a href="{{ url_for('ui.images_view') }}" class="tab {{ 'active' if active_page == 'images' else '' }}">{{
          t("nav.images") }}</a>
        <a href="{{ url_for('ui.volumes_view') }}" class="tab {{ 'active' if active_page == 'volumes' else '' }}">{{
          t("nav.volumes") }}</a>
        <a href="{{ url_for('ui.networks_view') }}" class="tab {{ 'active' if active_page == 'networks' else '' }}">{{
          t("nav.networks") }}</a>
        <a href="{{ url_for('ui.updates') }}" class="tab {{ 'active' if active_page == 'updates' else '' }}">{{
          t("nav.updates") }}</a>
        <a href="{{ url_for('ui.events_view') }}" class="tab {{ 'active' if active_page == 'events' else '' }}">{{
          t("nav.events") }}</a>
        <a href="{{ url_for('ui.autodiscovery_view') }}"
          class="tab {{ 'active' if active_page == 'autodiscovery' else '' }}">{{ t("nav.autodiscovery") }}</a>
        <a href="{{ url_for('auth.logout') }}" class="tab logout-link">{{ t("nav.logout") }}</a>
      </nav>
    </div>
  </header>

  {% include 'partials/flash_messages.html' %}

  <main>
    <section class="card filters">
      <form method="get" class="filters" aria-label="Filtri eventi">
        <label>
          <span class="muted">Intervallo</span><br />
          <select name="hours" class="select">
            {% for opt in [1,6,12,24,72,168] %}
            <option value="{{ opt }}" {% if selected_hours==opt %}selected{% endif %}>Ultime {{ opt }} ore</option>
            {% endfor %}
          </select>
        </label>
        <label>
          <span class="muted">Severità</span><br />
          <select name="severity" class="select">
            <option value="all" {% if selected_severity=='all' %}selected{% endif %}>Tutte</option>
            <option value="info" {% if selected_severity=='info' %}selected{% endif %}>Info</option>
            <option value="warning" {% if selected_severity=='warning' %}selected{% endif %}>Warning</option>
            <option value="error" {% if selected_severity=='error' %}selected{% endif %}>Errori</option>
          </select>
        </label>
        <button class="btn" type="submit">Aggiorna</button>
      </form>
    </section>

    <section class="card table-card">
      <div class="table-head">
        <div>
          <div class="meta">{{ events|length }} eventi trovati</div>
          <div class="muted">Host: {{ events[0].host if events else '-' }}</div>
        </div>
        <div class="badge">{{ selected_hours }}h di cronologia · Severità: {{ 'Tutte' if selected_severity == 'all' else
          selected_severity|title }}</div>
      </div>
      <table aria-label="Registro eventi di sistema">
        <thead>
          <tr>
            <th>Data</th>
            <th>Categoria</th>
            <th>Severità</th>
            <th>Dettagli evento</th>
            <th>{{ t("nav.containers") }}</th>
            <th>Host</th>
          </tr>
        </thead>
        <tbody>
          {% if events %}
          {% for ev in events %}
          <tr>
            <td data-label="Data">{{ ev.timestamp_local.strftime('%d/%m/%Y %H:%M:%S') }}</td>
            <td data-label="Categoria">{{ ev.type|title }}</td>
            <td data-label="Severità">
              <span
                class="sev-pill {% if ev.severity == 'error' %}sev-error{% elif ev.severity == 'warning' %}sev-warning{% else %}sev-info{% endif %}">
                <span class="sev-dot"></span>{{ ev.severity|title }}
              </span>
            </td>
            <td data-label="Dettagli">
              <div>{{ ev.detail }}</div>
              <div class="muted">{{ ev.source }}</div>
            </td>
            <td data-label="Container">{{ ev.name }} <span class="muted">({{ ev.id }})</span></td>
            <td data-label="Host">{{ ev.host }}</td>
          </tr>
          {% endfor %}
          {% else %}
          <tr>
            <td colspan="6" class="empty">Nessun evento disponibile per l'intervallo selezionato.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </section>
  </main>
  {% include 'partials/notifications_script.html' %}
</body>

</html>