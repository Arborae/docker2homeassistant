{% extends "layouts/app_base.html" %}
{% set page_title = 'D2HA – Immagini' %}

{% block page_styles %}
  <style>
    * { box-sizing: border-box; }

    .page-shell {
      display: flex;
      flex-direction: column;
      gap: var(--space-12, 24px);
    }

    .card-body { display: flex; flex-direction: column; gap: var(--space-6, 12px); }
    .card-meta { color: var(--color-muted, #9eb0c9); font-size: var(--font-size-sm, 0.875rem); }

    .table-wrapper { overflow-x: auto; }

    .table td strong { font-size: var(--font-size-md, 1rem); }

    .actions { text-align: right; }

    @media (max-width: 900px) {
      .table, .table thead, .table tbody, .table th, .table td, .table tr { display: block; }
      .table thead { display: none; }
      .table tr { margin-bottom: var(--space-4, 8px); border: 1px solid var(--color-border); border-radius: var(--radius-control, 12px); overflow: hidden; }
      .table td { display: flex; justify-content: space-between; align-items: center; gap: var(--space-4, 8px); }
      .table td::before { content: attr(data-label); font-weight: 700; color: var(--color-muted); }
      .actions { text-align: left; }
    }
  </style>
{% endblock %}

{% block page_content %}
  <div class="page-shell">
    <section class="card">
      <div class="card-body">
        <div class="card-meta">Totale immagini: {{ images|length }} · Container attivi: {{ summary.running }}</div>
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2>Immagini Docker</h2>
        <div class="actions">
          <a href="{{ url_for('containers_view') }}" class="btn btn-secondary">{{ t("nav.containers") }}</a>
        </div>
      </div>
      <div class="card-body">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th class="text-left">{{ t("images.table.name") }}</th>
                <th>{{ t("images.table.tags") }}</th>
                <th>{{ t("images.table.size") }}</th>
                <th class="text-right">{{ t("images.table.actions") }}</th>
              </tr>
            </thead>
            <tbody>
              {% for image in images %}
              <tr>
                <td data-label="{{ t('images.table.name') }}"><strong>{{ image.repository }}</strong></td>
                <td data-label="{{ t('images.table.tags') }}">
                  {% if image.tags %}
                  {{ image.tags|join(', ') }}
                  {% else %}
                  <span class="text-muted">{{ t('images.no_tags') }}</span>
                  {% endif %}
                </td>
                <td data-label="{{ t('images.table.size') }}">{{ image.size }}</td>
                <td data-label="{{ t('images.table.actions') }}" class="actions">
                  <form action="{{ url_for('delete_image', image_id=image.id) }}" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('{{ t('images.confirm_delete') }}')">{{ t("images.delete") }}</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </div>
{% endblock %}
